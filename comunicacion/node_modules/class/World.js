exports.World = function( params ){

	var defaults = {

		"tiles" : null,

		"createdObjects": {},

		"stats":{
			"levelGrowth": { // Ganancia al pasar de nivel
				"experience" : 1.4, // Multiplicador de la exp necesaria x nivel.
				"life": 10,
				"damage": 1
			}
		}

	}

	merge( defaults , params , this );

	this.create = function(){
		this.tiles = createArray( 30 , 30 , Tile );
		this.loadTiles([[{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua}],[{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Agua},{terrain:Agua}],[{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Agua}],[{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Agua}],[{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Agua},{terrain:Agua},{terrain:Tierra},{terrain:Tierra},{terrain:Agua}],[{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Tierra},{terrain:Tierra},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Tierra},{terrain:Tierra},{terrain:Agua}],[{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Tierra},{terrain:Tierra},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Tierra},{terrain:Tierra},{terrain:Agua}],[{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Tierra},{terrain:Tierra},{terrain:Agua}],[{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Tierra},{terrain:Tierra},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Tierra},{terrain:Agua}],[{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Tierra},{terrain:Tierra},{terrain:Agua}],[{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Tierra},{terrain:Tierra},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Tierra},{terrain:Tierra},{terrain:Agua}],[{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Agua},{terrain:Tierra},{terrain:Tierra},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Tierra},{terrain:Tierra},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Tierra},{terrain:Tierra},{terrain:Agua}],[{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Tierra},{terrain:Tierra},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Tierra},{terrain:Tierra},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Tierra},{terrain:Tierra},{terrain:Agua}],[{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Tierra},{terrain:Tierra},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Tierra},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Tierra},{terrain:Tierra},{terrain:Agua}],[{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Tierra},{terrain:Tierra},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Agua}],[{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Agua}],[{terrain:Tierra},{terrain:Tierra},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Tierra},{terrain:Tierra},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Agua}],[{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Agua},{terrain:Agua},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Agua}],[{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Agua},{terrain:Agua},{terrain:Tierra},{terrain:Tierra},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Tierra},{terrain:Tierra},{terrain:Agua},{terrain:Tierra},{terrain:Agua}],[{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Tierra},{terrain:Tierra},{terrain:Agua},{terrain:Tierra},{terrain:Tierra},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Tierra},{terrain:Agua}],[{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Tierra},{terrain:Agua}],[{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Agua},{terrain:Tierra},{terrain:Agua}],[{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Tierra},{terrain:Agua},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Agua}],[{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Tierra},{terrain:Agua}],[{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Tierra},{terrain:Tierra},{terrain:Agua}],[{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Tierra},{terrain:Tierra},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Agua}],[{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Agua},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Agua}],[{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Agua}],[{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Agua}],[{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Tierra},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua},{terrain:Agua}]] );
	}

	// Sirve para lo usuarios que se loguean
	this.createBeing = function( params ){
		var newBeing;
		var type = params.type;

		// Crea el Being ( el tipo de being que se le haya pasado )
		newBeing = new type({
			"position":{
				"x": 1,
				"y": 1
			},
			"name":"miElfo",
			"controls": params.controls,
			"id":params.userId
		})

		// Se fija en que posicion crear, dependiendo si es PC o NPC.
		newBeing.setSpawnPosition();
		// Instancia y manda al cliente
		this.createdObjects[newBeing.id] = newBeing;
		this.updateNewBeing({ "being" : newBeing })
		this.refreshTiles({ "element" : newBeing });
	}

	// Sirve para lo usuarios que se loguean
	this.createArtifact = function( params ){
		var newArtifact = params.artifact;
		test('se creo '+newArtifact.id)
		this.createdObjects[newArtifact.id] = newArtifact;
		this.updateNewArtifact({ "artifact" : newArtifact })
		this.refreshTiles({ "element" : newArtifact });
	}

	// Encuentra Being por id, sirve para cuando se envian controls, hacer que afecten al being con el ID dado por el cliente.
	this.findBeing = function( params ){
		//console.log( world.createdObjects[ params.id ] )
		return this.createdObjects[ params.userId ];
	}

	// Borra objeto del mapa
	this.removeObject = function( params ){
		delete this.createdObjects[ params.object.id ];
	}

	// Carga los tiles desde un array en donde se le define el terrain de cada uno.
	this.loadTiles = function( params ){
		for( var tx = 0 ; tx < params.length ; tx++ ){
			for( var ty = 0 ; ty < params[tx].length ; ty++ ){
				this.tiles[tx][ty].terrain = new params[ty][tx].terrain({"position":{"x":tx,"y":ty}});
			}
		}
	}

	// Devuelve tile en base a una posicion dada.
	this.getTile = function( position ){
		if( this.tiles[ position.x ] && this.tiles[ position.x ][ position.y ] ){
			return this.tiles[ position.x ][ position.y ];
		}else{
			return false;
		}
	}

	//------------------------------------------------------------------------
	// CREA LA INSTANCIA DE NUEVOS OBJECTOS
	//------------------------------------------------------------------------
	this.updateNewBeing = function( params ){
		SERVER.queue({
			"newBeing" : params.being
		});
	}

	this.updateNewArtifact = function( params ){
		SERVER.queue({
			"newArtifact" : params.artifact
		});
	}

	//----------------------------------------------------------------------------------
	// Genera un id aleatorio que no exista.
	//----------------------------------------------------------------------------------
	this.generateId = function( params ){
		var id;
		do{
			id = params.prefix + parseInt( Math.random() * 10000 );
		}while( id in world.createdObjects );
		return id;
	}


	//------------------------------------------------------------------------
	// refresca posicion de un elemento ( being , terrain u object)
	//------------------------------------------------------------------------
	this.refreshTiles = function( params ){

		// Verifica en que capa esta el objeto
		var element_type = params.element.type;

		// borra de la posicion anterior.
		if( params.lastPosition !== undefined ){
			this.getTile( params.lastPosition )[element_type] = null;
		}

		// lo crea en la nueva posicion.
		this.getTile( params.element.position )[element_type] = params.element;

		// Actualizo tiles en el cliente.
		var object = this.getTile( params.element.position )[element_type]
		if( params.lastPosition !== undefined ){
			this.updateSwapTile({ "object" : object , "lastPosition" : params.lastPosition }); // Si esta definida lastPosition, borra la ultima posicion
		}else{
			this.updateSwapTile({ "object" : object , "lastPosition" : object.position }); // Si esta definida lastPosition, borra la ultima posicion
		}

	}

	// Artifact
	this.updateArtifact = function( params ){// Actualiza objeto being/artifact en un tile dado.
		console.log("cantidad clonada",params.artifact.count)
		SERVER.queue({
			"artifact" : params.artifact.id ,
			"data" : {"all": [
					{ "tree" : ['count'] , "value" : params.artifact.count },
					{ "tree" : ['position'] , "value" : params.artifact.position }
				]
			}
		});

	}



	// Tile
	this.updateTile = function( params ){// Actualiza objeto being/artifact en un tile dado.
		if( params.object !== undefined ){
			SERVER.queue({
				"tile" : null ,
				"data" : { 'object' : params.object.id }
			});
		}

	}

	// Tile
	this.updateRemoveTile = function( params ){
		SERVER.queue({
			"tile" : "remove" ,
			"data" : { 'object' : params.object.id , 'lastPosition' : params.lastPosition }
		});
	}

	this.updateSwapTile = function( params ){
		SERVER.queue({
			"tile" : "swap" ,
			"data" : { 'object' : params.object.id , 'lastPosition' : params.lastPosition }
		});
	}

	// World
	this.updateWorldObjects = function( params ){ // Actualiza objetos instanciados en el world.
		// Funcion delete
		if( params.delete ){
			SERVER.queue({
				"world" : null ,
				"data" : { "object" : params.delete }
			});
		}
	}

}

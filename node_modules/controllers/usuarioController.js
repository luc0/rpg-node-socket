console.log('CONTROLLERS -> OK');


//------------------------------------------------------------------------------------------------
// Recibe del cliente
//------------------------------------------------------------------------------------------------
io.sockets.on("connection",function( socket ){

	//------------------------------------------------------------------------------------------------
	// LOGIN
	//------------------------------------------------------------------------------------------------
	socket.on("login",function( pj ){

		pj = new User();
		pj.username = pj.username;
		pj.setPosition( [ parseInt(Math.random() * 200) , parseInt(Math.random() * 200) ] );

		// Lo agrego al array global users.
		users[ pj.username ] = pj;

		console.log('----------------');
		console.log('USUARIOS:');
		console.log( users );
		console.log('----------------');

		// Nombro la conexion con su username.
		socket.user = pj.username;

		// Login Success, devuelvo Objeto User con datos moldeados. (id asignado por ej.)
		socket.emit( "login_success" , { 'pj': pj } );

		// Aparece el User en el MUNDO.

		io.sockets.emit( "users_update" , { 'users': users } );

	})


	//------------------------------------------------------------------------------------------------
	// KEYPRESSED controller
	//------------------------------------------------------------------------------------------------
	socket.on("user_position_update",function( data ){
		var username = data.username;
		var position = data.position;

		users[username].position = position;

		io.sockets.emit("user_position_update" , data );

	})

	//------------------------------------------------------------------------------------------------
	// KEYPRESSED controller
	//------------------------------------------------------------------------------------------------
	socket.on("keyPressed",function( character ){

		id = socket.user;

	})

	//------------------------------------------------------------------------------------------------
	// LOGOUT
	//------------------------------------------------------------------------------------------------
	socket.on('disconnect', function (){

		delete users[ socket.user ]
		io.sockets.emit("users_update",users)

	})
})
